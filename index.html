<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minecraft English - Learn + Game</title>
  <style>
    :root {
      --bg-a: #f8f4da;
      --bg-b: #e9f7d4;
      --panel: #ffffff;
      --ink: #20303a;
      --accent: #2f8f3b;
      --accent-2: #f0ad3c;
      --soft: #d6e9f7;
      --wrong: #d84a4a;
      --shadow: rgba(28, 47, 26, 0.18);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 15% 20%, #ffffff80 0 22%, transparent 23%),
        radial-gradient(circle at 85% 80%, #ffffff70 0 25%, transparent 26%),
        linear-gradient(160deg, var(--bg-a), var(--bg-b));
      display: grid;
      place-items: center;
      padding: 16px;
    }

    .app {
      width: min(1000px, 100%);
      background: var(--panel);
      border-radius: 20px;
      box-shadow: 0 18px 40px var(--shadow);
      overflow: hidden;
      border: 4px solid #d7e7c3;
    }

    .top {
      padding: 14px 18px;
      background: linear-gradient(90deg, #e6f4dc, #fdf7da);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .title {
      margin: 0;
      font-size: clamp(1.1rem, 2vw, 1.5rem);
    }

    .stats {
      display: flex;
      gap: 10px;
      font-weight: 700;
      font-size: 0.95rem;
    }

    .chip {
      background: #fff;
      border: 2px solid #dce9cf;
      border-radius: 999px;
      padding: 6px 12px;
    }

    .chip.turn-active {
      border-color: #2f8f3b;
      box-shadow: 0 0 0 3px #2f8f3b2a;
    }

    .content {
      padding: 20px;
      display: grid;
      gap: 16px;
    }

    .prompt {
      text-align: center;
      padding: 16px;
      border-radius: 16px;
      background: #f8fff2;
      border: 2px dashed #b8d59a;
    }

    .prompt h2 {
      margin: 0 0 8px;
      font-size: clamp(1.4rem, 3.4vw, 2.2rem);
    }

    .prompt p {
      margin: 0;
      font-size: clamp(1rem, 2.4vw, 1.2rem);
      font-weight: 700;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 14px;
      padding: 11px 16px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      transition: transform 0.12s ease, filter 0.12s ease;
    }

    button:hover { transform: translateY(-1px); filter: brightness(1.03); }
    button:active { transform: translateY(1px); }

    .btn-main { background: var(--accent); color: #fff; }
    .btn-alt { background: var(--accent-2); color: #231; }
    .btn-soft { background: var(--soft); color: #173248; }
    .btn-mode.active { outline: 3px solid #215c6d44; }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
    }

    .choice {
      background: #fff;
      border: 5px solid #a7bf92;
      border-radius: 16px;
      padding: 10px;
      display: grid;
      gap: 8px;
      min-height: 180px;
      align-content: start;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, transform 0.12s ease;
    }

    .choice:hover {
      border-color: #5f8f45;
      box-shadow: 0 0 0 6px #5f8f4526;
      transform: translateY(-1px);
    }

    .choice:focus-visible {
      outline: none;
      border-color: #2f8f3b;
      box-shadow: 0 0 0 7px #2f8f3b3a;
    }

    .choice img,
    .learn-card img {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: contain;
      image-rendering: pixelated;
      background: linear-gradient(160deg, #fbfff7, #edf8e6);
      border-radius: 12px;
      border: 2px solid #dbe8cc;
      padding: 10px;
      max-height: 220px;
    }

    .labels {
      text-align: center;
      line-height: 1.2;
      min-height: 2.6em;
      direction: rtl;
      font-size: 1.25rem;
      font-weight: 800;
    }

    .choice.correct {
      border-color: var(--accent);
      box-shadow: 0 0 0 8px #2f8f3b44;
    }

    .choice.wrong {
      border-color: var(--wrong);
      box-shadow: 0 0 0 8px #d84a4a42;
    }

    .learn-wrap {
      display: none;
      justify-content: center;
    }

    .learn-wrap.visible { display: flex; }

    .memory-wrap { display: none; }
    .memory-wrap.visible { display: block; }

    .memory-difficulty {
      margin: 0 auto 14px;
      width: min(680px, 100%);
      background: #f6fbf0;
      border: 2px solid #cfe2bc;
      border-radius: 14px;
      padding: 10px 12px;
      display: grid;
      gap: 8px;
    }

    .memory-difficulty .title {
      text-align: center;
      font-weight: 800;
      font-size: 0.96rem;
    }

    .memory-difficulty input[type="range"] {
      width: 100%;
      accent-color: #2f8f3b;
    }

    .memory-difficulty .scale {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      font-weight: 700;
      color: #3b4d41;
    }

    .memory-difficulty .picked {
      text-align: center;
      font-weight: 900;
      color: #214e2d;
    }

    .memory-board {
      display: grid;
      grid-template-columns: repeat(var(--memory-cols, 4), minmax(0, 1fr));
      gap: 12px;
      align-items: stretch;
    }

    .memory-card {
      border: 4px solid #9db88a;
      border-radius: 14px;
      background: #fff;
      height: var(--memory-card-h, 186px);
      padding: 8px;
      display: grid;
      place-items: center;
      transition: transform 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
    }

    .memory-card:hover {
      border-color: #4f8440;
      box-shadow: 0 0 0 5px #4f844026;
      transform: translateY(-1px);
    }

    .memory-card .face-back,
    .memory-card .face-front {
      width: 100%;
      display: grid;
      place-items: center;
      gap: 6px;
      height: 100%;
      grid-template-rows: minmax(0, 1fr) 36px;
    }

    .memory-card .face-back img,
    .memory-card .face-front img {
      width: 100%;
      aspect-ratio: 1/1;
      height: clamp(72px, calc(var(--memory-card-h, 186px) - 64px), 140px);
      object-fit: contain;
      image-rendering: pixelated;
      border-radius: 10px;
      border: 2px solid #c8d9ba;
      background: linear-gradient(160deg, #fbfff7, #edf8e6);
      padding: 8px;
    }

    .memory-card .face-back img {
      width: 84%;
      height: clamp(64px, calc(var(--memory-card-h, 186px) - 72px), 120px);
      border-radius: 12px;
      border-color: #b7cead;
      background: #eef6e7;
      padding: 6px;
    }

    .memory-card .face-back .back-label {
      color: #2f5d34;
      font-size: 0.95rem;
      font-weight: 800;
      letter-spacing: 0.03em;
      height: 36px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .memory-card .face-front .front-he {
      direction: rtl;
      font-size: 1.08rem;
      font-weight: 800;
      text-align: center;
      line-height: 1.1;
      height: 36px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .memory-board.compact .memory-card {
      padding: 6px;
      border-width: 3px;
    }

    .memory-board.compact .memory-card .face-front .front-he,
    .memory-board.compact .memory-card .face-back .back-label {
      font-size: 0.9rem;
      height: 30px;
    }

    .memory-board.compact .memory-card .face-back,
    .memory-board.compact .memory-card .face-front {
      grid-template-rows: minmax(0, 1fr) 30px;
    }

    .memory-card.matched {
      visibility: hidden;
      pointer-events: none;
    }

    .learn-card {
      width: min(340px, 100%);
      background: #fff;
      border: 3px solid #d9e5d0;
      border-radius: 16px;
      padding: 14px;
      text-align: center;
    }

    .learn-he {
      margin-top: 10px;
      font-size: 2rem;
      font-weight: 900;
      direction: rtl;
    }

    .learn-en {
      margin-top: 4px;
      font-size: 1.2rem;
      font-weight: 700;
      color: #42535d;
    }

    .status {
      text-align: center;
      min-height: 1.2em;
      font-weight: 800;
      font-size: 1.05rem;
    }

    .footer {
      text-align: center;
      color: #41554a;
      font-size: 0.92rem;
      padding: 0 20px 20px;
    }

    @media (max-width: 740px) {
      .grid { grid-template-columns: 1fr; }
      .choice { min-height: 140px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <h1 class="title">Minecraft English Game</h1>
      <div class="stats">
        <span class="chip">Mode: <span id="modeLabel">Learning</span></span>
        <span class="chip">Score: <span id="score">0</span></span>
        <span class="chip">Streak: <span id="streak">0</span></span>
        <span class="chip">Round: <span id="round">0</span></span>
        <span id="p1Chip" class="chip" style="display:none">Player 1: <span id="p1Score">0</span></span>
        <span id="p2Chip" class="chip" style="display:none">Player 2: <span id="p2Score">0</span></span>
        <span id="turnChip" class="chip" style="display:none">Turn: <span id="turnLabel">Player 1</span></span>
      </div>
    </div>

    <div class="content">
      <div class="prompt">
        <h2 id="enPrompt">Press Start</h2>
        <p id="hePrompt">לחצו התחלה</p>
      </div>

      <div class="controls">
        <button id="modeLearnBtn" class="btn-soft btn-mode active">Learning / למידה</button>
        <button id="modeGameBtn" class="btn-soft btn-mode">Game / משחק</button>
        <button id="modeMemoryBtn" class="btn-soft btn-mode">Memory / זיכרון</button>
        <button id="startBtn" class="btn-main">Start / התחל</button>
        <button id="repeatBtn" class="btn-alt" disabled>Repeat Sound / שוב</button>
        <button id="nextBtn" class="btn-alt">Next Word / מילה הבאה</button>
      </div>

      <div id="learnWrap" class="learn-wrap">
        <div class="learn-card">
          <img id="learnImg" alt="learning item" src="" />
          <div id="learnHe" class="learn-he"></div>
          <div id="learnEn" class="learn-en"></div>
        </div>
      </div>

      <div id="memoryWrap" class="memory-wrap">
        <div class="memory-difficulty">
          <div class="title">Memory Difficulty / רמת קושי</div>
          <input id="memorySizeSlider" type="range" min="0" max="4" step="1" value="0" />
          <div class="scale">
            <span>קל (16)</span>
            <span>הכי קשה (32)</span>
          </div>
          <div id="memoryPicked" class="picked">16 cards</div>
        </div>
        <div id="memoryBoard" class="memory-board"></div>
      </div>

      <div id="choices" class="grid"></div>
      <div id="status" class="status"></div>
    </div>

    <div class="footer">
      Learning mode: Hebrew then English + image. Game mode: hear English only, choose image + Hebrew label. Memory mode: 2 players, find pairs.
    </div>
  </div>

  <script>
    const items = [
      { key: 'diamond', en: 'diamond', he: 'יהלום', image: './assets/images/diamond.png' },
      { key: 'gold', en: 'gold', he: 'זהב', image: './assets/images/gold.png' },
      { key: 'grass', en: 'grass', he: 'דשא', image: './assets/images/grass.png' },
      { key: 'apple', en: 'apple', he: 'תפוח', heSpeech: 'תַּפּוּחַ', image: './assets/images/apple.png' },
      { key: 'sword', en: 'sword', he: 'חרב', image: './assets/images/sword.png' },
      { key: 'pickaxe', en: 'pickaxe', he: 'מכוש', image: './assets/images/pickaxe.png' },
      { key: 'torch', en: 'torch', he: 'לפיד', image: './assets/images/torch.png' },
      { key: 'bread', en: 'bread', he: 'לחם', heSpeech: 'לֶחֶם', image: './assets/images/bread.png' },
      { key: 'water', en: 'water bucket', he: 'דלי מים', heSpeech: 'דֵּלִי מַיִם', image: './assets/images/water_bucket.png' },
      { key: 'tree', en: 'tree', he: 'עץ', image: './assets/images/tree.png' },
      { key: 'iron', en: 'iron', he: 'ברזל', image: './assets/images/iron.png' },
      { key: 'coal', en: 'coal', he: 'פחם', image: './assets/images/coal.png' },
      { key: 'stone', en: 'stone', he: 'אבן', image: './assets/images/stone.png' },
      { key: 'dirt', en: 'dirt', he: 'עפר', heSpeech: 'עָפָר', image: './assets/images/dirt.png' },
      { key: 'sand', en: 'sand', he: 'חול', image: './assets/images/sand.png' },
      { key: 'glass', en: 'glass', he: 'זכוכית', image: './assets/images/glass.png' },
      { key: 'bed', en: 'bed', he: 'מיטה', image: './assets/images/bed.png' },
      { key: 'chest', en: 'chest', he: 'תיבה', image: './assets/images/chest.png' },
      { key: 'furnace', en: 'furnace', he: 'תנור', image: './assets/images/furnace.png' },
      { key: 'crafting_table', en: 'crafting table', he: 'שולחן יצירה', image: './assets/images/crafting_table.png' },
      { key: 'door', en: 'door', he: 'דלת', image: './assets/images/door.png' },
      { key: 'chestplate', en: 'diamond chestplate', he: 'שריון יהלום', image: './assets/images/chestplate.png' },
      { key: 'shovel', en: 'shovel', he: 'את', image: './assets/images/shovel.png' },
      { key: 'axe', en: 'axe', he: 'גרזן', image: './assets/images/axe.png' },
      { key: 'map', en: 'map', he: 'מפה', image: './assets/images/map.png' },
      { key: 'boat', en: 'boat', he: 'סירה', image: './assets/images/boat.png' },
      { key: 'cake', en: 'cake', he: 'עוגה', image: './assets/images/cake.png' },
      { key: 'golden_apple', en: 'golden apple', he: 'תפוח זהב', heSpeech: 'תַּפּוּחַ זָהָב', image: './assets/images/golden_apple.png' },
      { key: 'zombie', en: 'zombie', he: 'זומבי', image: './assets/images/zombie.png' },
      { key: 'skeleton', en: 'skeleton', he: 'שלד', image: './assets/images/skeleton.png' },
      { key: 'creeper', en: 'creeper', he: 'קריפר', image: './assets/images/creeper.png' },
      { key: 'spider', en: 'spider', he: 'עכביש', image: './assets/images/spider.png' },
      { key: 'cow', en: 'cow', he: 'פרה', image: './assets/images/cow.png' },
      { key: 'pig', en: 'pig', he: 'חזיר', image: './assets/images/pig.png' },
      { key: 'sheep', en: 'sheep', he: 'כבשה', heSpeech: 'כִּבְשָׂה', image: './assets/images/sheep.png' },
      { key: 'chicken', en: 'chicken', he: 'תרנגולת', image: './assets/images/chicken.png' },
      { key: 'wolf', en: 'wolf', he: 'זאב', image: './assets/images/wolf.png' },
      { key: 'cat', en: 'cat', he: 'חתול', image: './assets/images/cat.png' },
      { key: 'bee', en: 'bee', he: 'דבורה', image: './assets/images/bee.png' },
      { key: 'rabbit', en: 'rabbit', he: 'ארנב', image: './assets/images/rabbit.png' },
      { key: 'horse', en: 'horse', he: 'סוס', image: './assets/images/horse.png' },
      { key: 'donkey', en: 'donkey', he: 'חמור', image: './assets/images/donkey.png' },
      { key: 'llama', en: 'llama', he: 'לאמה', heSpeech: 'לָאמָה', image: './assets/images/llama.png' },
      { key: 'camel', en: 'camel', he: 'גמל', image: './assets/images/camel.png' },
      { key: 'fox', en: 'fox', he: 'שועל', image: './assets/images/fox.png' },
      { key: 'frog', en: 'frog', he: 'צפרדע', image: './assets/images/frog.png' },
      { key: 'turtle', en: 'turtle', he: 'צב', image: './assets/images/turtle.png' },
      { key: 'dolphin', en: 'dolphin', he: 'דולפין', image: './assets/images/dolphin.png' },
      { key: 'bat', en: 'bat', he: 'עטלף', image: './assets/images/bat.png' },
      { key: 'parrot', en: 'parrot', he: 'תוכי', image: './assets/images/parrot.png' },
      { key: 'panda', en: 'panda', he: 'פנדה', image: './assets/images/panda.png' },
      { key: 'polar_bear', en: 'polar bear', he: 'דוב קוטב', image: './assets/images/polar_bear.png' },
      { key: 'goat', en: 'goat', he: 'עז', heSpeech: 'עֵז', image: './assets/images/goat.png' },
      { key: 'mushroom', en: 'mushroom', he: 'פטרייה', image: './assets/images/mushroom.png' },
      { key: 'flower', en: 'flower', he: 'פרח', image: './assets/images/flower.png' },
      { key: 'fish', en: 'fish', he: 'דג', image: './assets/images/fish.png' },
      { key: 'heart', en: 'heart', he: 'לב', image: './assets/images/heart.png' },
      { key: 'house', en: 'house', he: 'בית', image: './assets/images/house.png' },
      { key: 'window', en: 'window', he: 'חלון', image: './assets/images/window.jpg' },
      { key: 'stairs', en: 'stairs', he: 'מדרגות', image: './assets/images/stairs.png' },
      { key: 'book', en: 'book', he: 'ספר', image: './assets/images/book.png' },
      { key: 'clock', en: 'clock', he: 'שעון', image: './assets/images/clock.png' },
      { key: 'compass', en: 'compass', he: 'מצפן', image: './assets/images/compass.png' },
      { key: 'sign', en: 'sign', he: 'שלט', image: './assets/images/sign.png' },
      { key: 'fence', en: 'fence', he: 'גדר', image: './assets/images/fence.png' },
      { key: 'bridge', en: 'bridge', he: 'גשר', image: './assets/images/bridge.png' },
      { key: 'river', en: 'river', he: 'נהר', image: './assets/images/river.png' },
      { key: 'mountain', en: 'mountain', he: 'הר', image: './assets/images/mountain.png' },
      { key: 'forest', en: 'forest', he: 'יער', image: './assets/images/forest.png' },
      { key: 'desert', en: 'desert', he: 'מדבר', heSpeech: 'מִדְבָּר', image: './assets/images/desert.png' },
      { key: 'cave', en: 'cave', he: 'מערה', image: './assets/images/cave.png' },
      { key: 'island', en: 'island', he: 'אי', image: './assets/images/island.png' },
      { key: 'star', en: 'star', he: 'כוכב', image: './assets/images/star.png' },
      { key: 'sun', en: 'sun', he: 'שמש', image: './assets/images/sun.png' },
      { key: 'moon', en: 'moon', he: 'ירח', image: './assets/images/moon.png' },
      { key: 'rain', en: 'rain', he: 'גשם', image: './assets/images/rain.png' },
      { key: 'snow', en: 'snow', he: 'שלג', image: './assets/images/snow.png' },
      { key: 'fire', en: 'fire', he: 'אש', image: './assets/images/fire.png' }
    ];

    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const roundEl = document.getElementById('round');
    const modeLabelEl = document.getElementById('modeLabel');
    const p1ChipEl = document.getElementById('p1Chip');
    const p2ChipEl = document.getElementById('p2Chip');
    const turnChipEl = document.getElementById('turnChip');
    const p1ScoreEl = document.getElementById('p1Score');
    const p2ScoreEl = document.getElementById('p2Score');
    const turnLabelEl = document.getElementById('turnLabel');
    const enPromptEl = document.getElementById('enPrompt');
    const hePromptEl = document.getElementById('hePrompt');
    const startBtn = document.getElementById('startBtn');
    const repeatBtn = document.getElementById('repeatBtn');
    const nextBtn = document.getElementById('nextBtn');
    const modeLearnBtn = document.getElementById('modeLearnBtn');
    const modeGameBtn = document.getElementById('modeGameBtn');
    const modeMemoryBtn = document.getElementById('modeMemoryBtn');
    const choicesEl = document.getElementById('choices');
    const learnWrapEl = document.getElementById('learnWrap');
    const memoryWrapEl = document.getElementById('memoryWrap');
    const memorySizeSliderEl = document.getElementById('memorySizeSlider');
    const memoryPickedEl = document.getElementById('memoryPicked');
    const memoryBoardEl = document.getElementById('memoryBoard');
    const learnImgEl = document.getElementById('learnImg');
    const learnHeEl = document.getElementById('learnHe');
    const learnEnEl = document.getElementById('learnEn');
    const statusEl = document.getElementById('status');

    let mode = 'learn';
    const modeStarted = { learn: false, game: false, memory: false };
    let score = 0;
    let streak = 0;
    let round = 0;
    let currentTarget = null;
    let currentChoices = [];
    let acceptingAnswer = false;
    let memoryDeck = [];
    let memoryFirst = null;
    let memorySecond = null;
    let memoryBusy = false;
    let memoryTurn = 0;
    let memoryScores = [0, 0];
    let memoryPairsLeft = 0;
    const memoryCardOptions = [16, 20, 24, 28, 32];
    let memorySizeIndex = 0;

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function shuffle(arr) {
      const c = [...arr];
      for (let i = c.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [c[i], c[j]] = [c[j], c[i]];
      }
      return c;
    }

    function speak(text, lang = 'en-US', rate = 0.86) {
      if (!('speechSynthesis' in window)) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = rate;
      const voices = speechSynthesis.getVoices();
      const voice = voices.find(v => v.lang.toLowerCase().startsWith(lang.slice(0, 2).toLowerCase()));
      if (voice) utterance.voice = voice;
      speechSynthesis.speak(utterance);
    }

    function getHeSpeech(item) {
      return item.heSpeech || item.he;
    }

    function updateHUD() {
      scoreEl.textContent = score;
      streakEl.textContent = streak;
      roundEl.textContent = round;
      if (mode === 'learn') modeLabelEl.textContent = 'Learning';
      if (mode === 'game') modeLabelEl.textContent = 'Game';
      if (mode === 'memory') modeLabelEl.textContent = 'Memory';
    }

    function updateMemoryHUD() {
      p1ScoreEl.textContent = memoryScores[0];
      p2ScoreEl.textContent = memoryScores[1];
      turnLabelEl.textContent = memoryTurn === 0 ? 'Player 1' : 'Player 2';
      p1ChipEl.classList.toggle('turn-active', memoryTurn === 0);
      p2ChipEl.classList.toggle('turn-active', memoryTurn === 1);
    }

    function updateMemoryDifficultyUI() {
      const cards = memoryCardOptions[memorySizeIndex];
      const level = memorySizeIndex === 0 ? 'קל' : (memorySizeIndex === 4 ? 'הכי קשה' : 'בינוני');
      memoryPickedEl.textContent = `${cards} קלפים (${level})`;
      if (mode === 'memory' && modeStarted.memory && memoryDeck.length) updateMemoryLayout();
    }

    function updateMemoryLayout() {
      if (mode !== 'memory') return;
      if (!memoryDeck.length) return;
      const cards = memoryCardOptions[memorySizeIndex];
      const boardRect = memoryBoardEl.getBoundingClientRect();
      const boardWidth = Math.max(280, boardRect.width || memoryBoardEl.clientWidth || 320);
      const gap = 12;

      const isNarrow = window.innerWidth < 740;
      let cols;
      if (isNarrow) {
        if (cards <= 16) cols = 4;
        else if (cards <= 24) cols = 5;
        else cols = 6;
      } else {
        if (cards <= 16) cols = 4;
        else if (cards <= 20) cols = 5;
        else if (cards <= 24) cols = 6;
        else if (cards <= 28) cols = 7;
        else cols = 8;
      }

      const cardW = (boardWidth - gap * (cols - 1)) / cols;
      // Stable heights per difficulty so images stay readable and layout doesn't jump.
      let targetH;
      if (cards <= 16) targetH = isNarrow ? 150 : 172;
      else if (cards <= 20) targetH = isNarrow ? 142 : 160;
      else if (cards <= 24) targetH = isNarrow ? 132 : 148;
      else if (cards <= 28) targetH = isNarrow ? 122 : 136;
      else targetH = isNarrow ? 112 : 124;

      const cardH = Math.max(96, Math.floor(Math.min(cardW * 1.1, targetH)));
      const best = { cols, cardH };

      memoryBoardEl.style.setProperty('--memory-cols', String(best.cols));
      memoryBoardEl.style.setProperty('--memory-card-h', `${best.cardH}px`);
      memoryBoardEl.classList.toggle('compact', best.cardH < 145);
    }

    function setMode(nextMode) {
      mode = nextMode;
      modeLearnBtn.classList.toggle('active', mode === 'learn');
      modeGameBtn.classList.toggle('active', mode === 'game');
      modeMemoryBtn.classList.toggle('active', mode === 'memory');
      choicesEl.innerHTML = '';
      memoryBoardEl.innerHTML = '';
      statusEl.textContent = '';
      speechSynthesis.cancel();
      p1ChipEl.style.display = mode === 'memory' ? 'inline-block' : 'none';
      p2ChipEl.style.display = mode === 'memory' ? 'inline-block' : 'none';
      turnChipEl.style.display = mode === 'memory' ? 'inline-block' : 'none';

      if (mode === 'learn') {
        learnWrapEl.classList.remove('visible');
        memoryWrapEl.classList.remove('visible');
        choicesEl.style.display = 'none';
        nextBtn.style.display = modeStarted.learn ? 'inline-block' : 'none';
        repeatBtn.style.display = modeStarted.learn ? 'inline-block' : 'none';
        learnImgEl.src = '';
        learnHeEl.textContent = '';
        learnEnEl.textContent = '';
        enPromptEl.textContent = 'Learning Mode';
        hePromptEl.textContent = 'לחצו Start כדי להתחיל מצב למידה';
      } else if (mode === 'game') {
        learnWrapEl.classList.remove('visible');
        memoryWrapEl.classList.remove('visible');
        choicesEl.style.display = 'grid';
        nextBtn.style.display = 'none';
        repeatBtn.style.display = modeStarted.game ? 'inline-block' : 'none';
        enPromptEl.textContent = 'Game Mode';
        hePromptEl.textContent = 'מצב משחק: בחרו את המילה הנכונה';
      } else {
        learnWrapEl.classList.remove('visible');
        memoryWrapEl.classList.add('visible');
        choicesEl.style.display = 'none';
        nextBtn.style.display = 'none';
        repeatBtn.style.display = 'none';
        enPromptEl.textContent = 'Memory Mode - 2 Players';
        hePromptEl.textContent = 'מצאו זוגות. זוג נכון = נקודה + תור נוסף';
      }
      updateHUD();
      updateMemoryHUD();
    }

    function speakLearning(item) {
      speechSynthesis.cancel();
      speak(getHeSpeech(item), 'he-IL', 0.82);
      setTimeout(() => speak(item.en, 'en-US', 0.86), 850);
    }

    function speakGamePrompt(item) {
      speechSynthesis.cancel();
      speak(`Find ${item.en}`, 'en-US', 0.86);
    }

    function renderLearningCard(item) {
      learnImgEl.src = item.image;
      learnImgEl.alt = item.en;
      learnHeEl.textContent = item.he;
      learnEnEl.textContent = item.en;
    }

    function nextLearningWord() {
      learnWrapEl.classList.add('visible');
      currentTarget = pickRandom(items);
      renderLearningCard(currentTarget);
      enPromptEl.textContent = `Learn: ${currentTarget.en}`;
      hePromptEl.textContent = `${currentTarget.he} = ${currentTarget.en}`;
      statusEl.textContent = '';
      speakLearning(currentTarget);
    }

    function renderGameChoices() {
      choicesEl.innerHTML = '';
      currentChoices.forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'choice';
        btn.type = 'button';
        btn.dataset.key = item.key;
        btn.innerHTML = `
          <img alt="${item.en}" src="${item.image}" loading="lazy" />
          <div class="labels">${item.he}</div>
        `;
        btn.addEventListener('click', () => handleGameAnswer(btn, item));
        choicesEl.appendChild(btn);
      });
    }

    function nextGameRound() {
      round += 1;
      updateHUD();
      statusEl.textContent = '';

      currentTarget = pickRandom(items);
      const pool = items.filter(i => i.key !== currentTarget.key);
      const optionCount = round <= 3 ? 3 : 4;
      currentChoices = shuffle([currentTarget, ...shuffle(pool).slice(0, optionCount - 1)]);

      enPromptEl.textContent = `Find: ${currentTarget.en}`;
      hePromptEl.textContent = 'בחרו את המילה המתאימה בעברית';

      renderGameChoices();
      acceptingAnswer = true;
      speakGamePrompt(currentTarget);
    }

    function handleGameAnswer(buttonEl, chosenItem) {
      if (!acceptingAnswer || mode !== 'game') return;
      acceptingAnswer = false;
      const buttons = [...document.querySelectorAll('.choice')];

      if (chosenItem.key === currentTarget.key) {
        score += 10;
        streak += 1;
        buttonEl.classList.add('correct');
        statusEl.textContent = 'נכון! כל הכבוד!';
        speechSynthesis.cancel();
        speak(`Great. ${currentTarget.en}`, 'en-US', 0.88);
      } else {
        streak = 0;
        buttonEl.classList.add('wrong');
        const correct = buttons.find(b => b.dataset.key === currentTarget.key);
        if (correct) correct.classList.add('correct');
        statusEl.textContent = `לא נורא. התשובה היא: ${currentTarget.he}`;
        speechSynthesis.cancel();
        speak(`The answer is ${currentTarget.en}`, 'en-US', 0.85);
      }

      updateHUD();
      setTimeout(nextGameRound, 1500);
    }

    function isMemoryOpen(card) {
      return card.matched || memoryFirst?.id === card.id || memorySecond?.id === card.id;
    }

    function renderMemoryBoard() {
      memoryBoardEl.innerHTML = '';
      memoryDeck.forEach(card => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = `memory-card${card.matched ? ' matched' : ''}`;
        btn.disabled = card.matched || memoryBusy;

        if (isMemoryOpen(card)) {
          btn.innerHTML = `
            <div class="face-front">
              <img alt="${card.item.en}" src="${card.item.image}" loading="lazy" />
              <div class="front-he">${card.item.he}</div>
            </div>
          `;
        } else {
          btn.innerHTML = `
            <div class="face-back">
              <img alt="Minecraft logo" src="./assets/images/card_back_logo.png" loading="lazy" />
              <div class="back-label">MEMORY</div>
            </div>
          `;
        }

        btn.addEventListener('click', () => onMemoryCardClick(card.id));
        memoryBoardEl.appendChild(btn);
      });
    }

    function finishMemoryGame() {
      if (memoryScores[0] === memoryScores[1]) {
        statusEl.textContent = `תיקו! ${memoryScores[0]} - ${memoryScores[1]}`;
      } else if (memoryScores[0] > memoryScores[1]) {
        statusEl.textContent = `שחקן 1 ניצח! ${memoryScores[0]} - ${memoryScores[1]}`;
      } else {
        statusEl.textContent = `שחקן 2 ניצח! ${memoryScores[1]} - ${memoryScores[0]}`;
      }
      enPromptEl.textContent = 'Memory Finished';
      hePromptEl.textContent = 'המשחק נגמר. לחצו Start למשחק חדש';
    }

    function onMemoryCardClick(cardId) {
      if (!modeStarted.memory || !memoryDeck.length) return;
      if (mode !== 'memory' || memoryBusy) return;
      const card = memoryDeck.find(c => c.id === cardId);
      if (!card || card.matched) return;
      if (memoryFirst && memoryFirst.id === card.id) return;
      if (memorySecond) return;

      if (!memoryFirst) {
        memoryFirst = card;
        renderMemoryBoard();
        return;
      }

      memorySecond = card;
      round += 1;
      updateHUD();
      renderMemoryBoard();

      if (memoryFirst.item.key === memorySecond.item.key) {
        memoryScores[memoryTurn] += 1;
        memoryFirst.matched = true;
        memorySecond.matched = true;
        memoryPairsLeft -= 1;
        statusEl.textContent = `זוג נכון! שחקן ${memoryTurn + 1} ממשיך`;
        updateMemoryHUD();
        setTimeout(() => {
          memoryFirst = null;
          memorySecond = null;
          renderMemoryBoard();
          if (memoryPairsLeft === 0) {
            finishMemoryGame();
          }
        }, 700);
      } else {
        memoryBusy = true;
        statusEl.textContent = 'לא זוג. מחליפים תור...';
        setTimeout(() => {
          memoryFirst = null;
          memorySecond = null;
          memoryTurn = memoryTurn === 0 ? 1 : 0;
          memoryBusy = false;
          updateMemoryHUD();
          statusEl.textContent = `תור שחקן ${memoryTurn + 1}`;
          renderMemoryBoard();
        }, 1100);
      }
    }

    function startMemoryGame() {
      score = 0;
      streak = 0;
      round = 0;
      memoryTurn = 0;
      memoryScores = [0, 0];
      memoryBusy = false;
      memoryFirst = null;
      memorySecond = null;

      const pairCount = memoryCardOptions[memorySizeIndex] / 2;
      const selected = shuffle(items).slice(0, pairCount);
      memoryDeck = shuffle(selected.flatMap(item => ([
        { id: `${item.key}-a`, item, matched: false },
        { id: `${item.key}-b`, item, matched: false }
      ])));
      memoryPairsLeft = pairCount;
      updateMemoryLayout();

      enPromptEl.textContent = 'Memory Mode - 2 Players';
      hePromptEl.textContent = 'מצאו זוגות. זוג נכון = נקודה + תור נוסף';
      statusEl.textContent = 'תור שחקן 1';
      updateHUD();
      updateMemoryHUD();
      renderMemoryBoard();
    }

    function resetMemoryToStartState() {
      modeStarted.memory = false;
      score = 0;
      streak = 0;
      round = 0;
      memoryTurn = 0;
      memoryScores = [0, 0];
      memoryBusy = false;
      memoryFirst = null;
      memorySecond = null;
      memoryPairsLeft = 0;
      memoryDeck = [];
      memoryBoardEl.innerHTML = '';
      setMode('memory');
      statusEl.textContent = 'שיניתם קושי. לחצו Start למשחק חדש';
      updateHUD();
      updateMemoryHUD();
    }

    function startMode() {
      modeStarted[mode] = true;
      repeatBtn.disabled = false;
      setMode(mode);
      if (mode === 'learn') {
        round = 0;
        score = 0;
        streak = 0;
        updateHUD();
        nextLearningWord();
      } else if (mode === 'game') {
        score = 0;
        streak = 0;
        round = 0;
        updateHUD();
        nextGameRound();
      } else {
        startMemoryGame();
      }
    }

    startBtn.addEventListener('click', startMode);

    repeatBtn.addEventListener('click', () => {
      if (!currentTarget) return;
      if (mode === 'learn') speakLearning(currentTarget);
      if (mode === 'game') speakGamePrompt(currentTarget);
    });

    nextBtn.addEventListener('click', () => {
      if (mode === 'learn') nextLearningWord();
    });

    modeLearnBtn.addEventListener('click', () => setMode('learn'));
    modeGameBtn.addEventListener('click', () => setMode('game'));
    modeMemoryBtn.addEventListener('click', () => setMode('memory'));
    memorySizeSliderEl.addEventListener('input', (e) => {
      memorySizeIndex = Number(e.target.value);
      updateMemoryDifficultyUI();
      if (mode === 'memory') {
        resetMemoryToStartState();
      }
    });
    window.addEventListener('resize', () => {
      if (mode === 'memory') updateMemoryLayout();
    });

    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }

    updateMemoryDifficultyUI();
    setMode('learn');
  </script>
</body>
</html>
